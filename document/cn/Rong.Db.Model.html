<!DOCTYPE html>
<html>
    <head>
        <title>数据库模型</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <link href="style.css" rel="stylesheet" type="text/css" />        <meta name="keywords" content="数据库模型,Rong Framework" />
        <meta name="description" content="数据库模型,Rong Framework" />
    </head>
    <body>
        <div class="Page">
            <div class="top">
    <div class="rf">Rong Framework</div>
</div>            <div class="content"> 
                <div>
                    <a href="index.html">目录</a>
                </div>
                
                 <div class="ctrl">
                    上一页:
                                        <a href="Rong.Db.Driver.Sqlite.php"> Rong_Db连接到sqlite</a>
                    
                    &nbsp;
                    <a href="index.html">目录</a>
                    &nbsp;
                    下一页 :
                                        <a href="Rong.Db.Paginator.html">分页</a>
                                    </div> 
                <h3>数据库模型</h3>
                <h1>模型</h1>


<p><br>
<span class="title1">一、新建一个模型</span></p><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />*&nbsp;file&nbsp;name:&nbsp;/test/models/ArticleModel.php<br />*/<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'Rong/Db/Model.php'</span><span style="color: #007700">;<br />class&nbsp;</span><span style="color: #0000BB">ArticleModel&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Rong_Db_Model&nbsp;<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">__construct</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setNameWithDefaultTablePrefix</span><span style="color: #007700">(</span><span style="color: #DD0000">"article"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//assign&nbsp;"w_article"&nbsp;&nbsp;to&nbsp;$_name&nbsp;(table&nbsp;name)<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">m_insert</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$content&nbsp;</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"title"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$title&nbsp;</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"content"&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$content&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">insert</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;insert()return&nbsp;last_insert_id,&nbsp;or&nbsp;-1<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><br>模型的文件名为ArticleModel,是"<strong>Rong_Db_Model</strong>"的子类。 它的 $_name 属性是表名。<br><p>
插入数据的形式为：</p>

<pre><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php&nbsp;<br />$data&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"字段名1"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$值1&nbsp;</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"字段名2"&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$值2&nbsp;</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;......<br />);<br />return&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">insert</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">);&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//返回最后插入的id&nbsp;<br /><br />//或者实例化后直接调用插入操作<br /></span><span style="color: #0000BB">$articleModel&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ArticleModel</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$newArticleId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"title"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"the&nbsp;controller&nbsp;of&nbsp;rong&nbsp;framework"</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"content"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"description..."<br /></span><span style="color: #007700">));&nbsp;</span><span style="color: #FF8000">//$newArticleId是返回值</span></span></code></div>
</pre>

<p><span class="title1">三、使用这个模型<br>在<a href="./Rong.Db.html">初始化Rong_Db的实例</a>后，我们要把这个实例告诉Rong_Db_Model,以便它能识别是哪个实例.</span></p><p><span class="title1"><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'Rong/Db/Model.php'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Rong_Db_Model</span><span style="color: #007700">::</span><span style="color: #0000BB">setDefaultDb</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">);</span></span></code></div><br></span></p><p><span class="title1">3.1引入刚才建的模型并实例化:<br><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"/models/ArticleModel.php"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$articleModel&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ArticleModel</span><span style="color: #007700">();</span></span></code></div></span></p><p><span class="title1">3.2向数据库插入数据<br><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$lastInsertId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"title"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"good&nbsp;good&nbsp;study"</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"content"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"day&nbsp;day&nbsp;up"<br /></span><span style="color: #007700">));<br />echo&nbsp;</span><span style="color: #DD0000">"last&nbsp;insert&nbsp;id:"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$lastInsertId&nbsp;</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;</span></span></code></div></span></p><p><span class="title1">3.3 修改数据<br><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$affectedRows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"title"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"new&nbsp;title"</span><span style="color: #FF8000">//&nbsp;db&nbsp;field&nbsp;name&nbsp;=&gt;&nbsp;value<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"id="&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$lastInsertId<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"update&nbsp;affected&nbsp;rows:"</span><span style="color: #007700">.</span><span style="color: #0000BB">$affectedRows&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;</span><span style="color: #0000BB"> </span></span></code></div></span></p><p><span class="title1">3.4 删除数据</span></p><p><span class="title1"><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$affectedRows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #DD0000">"id="&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$lastInsertId</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Deletion&nbsp;affected&nbsp;rows:"</span><span style="color: #007700">.</span><span style="color: #0000BB">$affectedRows&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;</span></span></code></div><br>3.5 获取一行记录：<br><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$record&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchRow</span><span style="color: #007700">(</span><span style="color: #DD0000">"id=1"&nbsp;</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"fetch&nbsp;a&nbsp;record:"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$record&nbsp;</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;</span></span></code></div><br>3.6 获取多行记录：</span></p><p><span class="title1"><div class="code"  ><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$records&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$articleModel</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #DD0000">"id&gt;0"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"fetch&nbsp;all&nbsp;records:&lt;pre&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/pre&gt;"</span><span style="color: #007700">;</span></span></code></div></span></p><p><span class="title1"><br></span></p><p><span class="title1"><br></span></p>
 

<p><b>Rong_Db_Model::setDb( $db )</b><br>
确定模型使用的是哪个 $db 对象。<br>
<b>$articleModel = $this-&gt;import-&gt;model("ArticleModel" ); </b><br>
实例化一个数据库模型，也就是我们刚才建立的 ArticleModel.php<br>
<span class="title1">四、基本模型方法</span><br>
<b>Rong_Db_Model::setModelsDir( $modelDir )</b><br>
设置模型的路径。$modelDir为放置模型的新路径<br>
<b>Rong_Db_Model::setName( $newName )</b><br>
设置数据模型的新表名。<br>
<b>Rong_Db_Model::getName( )</b><br>
取得当前的表名。<br>
<b>Rong_Db_Model::insert( $data )</b><br>
插入数据。<br>
<b>Rong_Db_Model::update( $data , $where )</b><br>
$data 是一个"字段名=&gt;值"形式的一维数组，$where 是sql语句中$where 之后的句子。<br>
<b>Rong_Db_Model::delete( $where )</b><br>
按$where中的条件删除数据。<br>
<b>Rong_Db_Model::fetchRow( $where )</b><br>
根据where语名取得一行数据。<br>
<b>Rong_Db_Model::escape( $str )</b><br>
过滤特殊符号，例如单引号。<br>
<b>$Rong_Db_Model-&gt;db-&gt;numFields()</b><br>
返回结果集的字段数<br>
<b>$Rong_Db_Model-&gt;db-&gt;numRows()</b><br>
返回结果集的行数。<br>
Rong_Db_Model::fetchCount( $where )<br>
取得行数</p>









                <div class="ctrl">
                    上一页:
                                        <a href="Rong.Db.Driver.Sqlite.php"> Rong_Db连接到sqlite</a>
                    
                    &nbsp;
                    <a href="index.html">目录</a>
                    &nbsp;
                    下一页 :
                                        <a href="Rong.Db.Paginator.html">分页</a>
                                    </div> 
            </div>
            <div class="bottom">
 要获取最新的Rong Framework,请访问<a href="http://rong.wudimei.com" target="_balnk">http://rong.wudimei.com</a></div>  
        </div>
    </body>
</html>